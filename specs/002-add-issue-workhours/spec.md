# Feature Specification: Add Issue Work Hours

**Feature Branch**: `002-add-issue-workhours`  
**Created**: 2025-11-10  
**Status**: Draft  
**Input**: User description: "根据示例代码，实现添加工时工具，projectId从环境变量中获取，issueId从用户输入中获取，其他参数包括起止时间，工时数和工时类型。工时类型参考：工时类型id（项目预设工时类型id及名称对照：21:研发设计，22:后端开发，23:前端开发(Web)，24:前端开发(小程序)，25:前端开发(App)， 26:测试验证，27:缺陷修复，28:UI设计，29:会议，30:公共事务，31:培训，32:研究，33:其它，34:调休请假）"

## User Scenarios & Testing _(mandatory)_

### User Story 1 - Record Basic Work Hours (Priority: P1)

开发人员完成一项任务后，需要向项目管理系统记录工作时间。用户提供任务标识、工作时长（小时数）、工时类型（如后端开发、前端开发等）以及工作的起止日期，系统将工时信息保存到项目管理系统中。

**Why this priority**: 这是核心功能，记录工时是项目管理的基本需求，没有此功能无法实现任何工时管理操作。这是最小可用产品（MVP）。

**Independent Test**: 可以通过提供一个有效的任务标识、工时数（如2小时）、工时类型（如后端开发）和日期范围，独立测试添加工时功能，验证系统返回成功响应。

**Acceptance Scenarios**:

1. **Given** 用户已完成系统配置，**When** 用户输入有效的任务标识、工时数、工时类型和起止日期，**Then** 系统成功将工时记录添加到项目管理系统
2. **Given** 用户已完成系统配置，**When** 用户输入任务标识但未提供工时数，**Then** 系统提示必须提供工时数
3. **Given** 用户已完成系统配置，**When** 用户输入任务标识但未提供工时类型，**Then** 系统提示必须选择工时类型
4. **Given** 用户已完成系统配置，**When** 用户输入任务标识但未提供起止日期，**Then** 系统提示必须提供工作日期范围

---

### User Story 2 - Select Work Hour Type from Predefined List (Priority: P2)

用户在记录工时时，可以从预定义的工时类型列表中选择（如研发设计、后端开发、前端开发等），系统展示清晰的类型名称，帮助用户准确分类工时。

**Why this priority**: 提升用户体验，避免用户手动输入错误的工时类型。这是对核心功能的改进，但不影响基本功能可用性。

**Independent Test**: 可以独立测试工时类型选择界面，验证是否正确显示所有14种预设工时类型及其名称，并能正确识别用户选择。

**Acceptance Scenarios**:

1. **Given** 用户需要记录工时，**When** 用户请求选择工时类型，**Then** 系统显示所有14种预设工时类型及其名称
2. **Given** 用户查看工时类型列表，**When** 用户选择"后端开发"，**Then** 系统自动使用对应的工时类型标识
3. **Given** 用户查看工时类型列表，**When** 用户选择"调休请假"，**Then** 系统自动使用对应的工时类型标识

---

### User Story 3 - Validate Date Range (Priority: P2)

用户输入起止日期时，系统验证日期格式和逻辑有效性（起始日期不能晚于结束日期），确保数据准确性。

**Why this priority**: 数据验证是确保数据质量的重要环节，但可以在核心功能之后实现，初期可由用户自行保证数据正确性。

**Independent Test**: 可以独立测试日期验证逻辑，提供各种有效和无效的日期组合，验证系统是否正确拒绝无效输入。

**Acceptance Scenarios**:

1. **Given** 用户输入工时信息，**When** 用户输入的起始日期晚于结束日期，**Then** 系统提示日期范围无效
2. **Given** 用户输入工时信息，**When** 用户输入的日期格式不正确（非YYYY-MM-DD格式），**Then** 系统提示日期格式错误
3. **Given** 用户输入工时信息，**When** 用户输入的起始日期早于或等于结束日期且格式正确，**Then** 系统接受日期输入

---

### User Story 4 - Handle Configuration Errors (Priority: P3)

当项目ID环境变量未配置或API认证信息（AK/SK）缺失时，系统提供清晰的错误提示，指导用户完成必要的配置。

**Why this priority**: 错误处理改善用户体验，但不是核心业务逻辑，可以在后期完善。

**Independent Test**: 可以独立测试配置验证功能，移除环境变量后运行工具，验证是否提供有用的错误消息。

**Acceptance Scenarios**:

1. **Given** 必要的系统配置未完成，**When** 用户尝试添加工时，**Then** 系统提示需要完成必要配置
2. **Given** 系统认证信息缺失，**When** 用户尝试添加工时，**Then** 系统提示需要配置认证信息
3. **Given** 系统连接配置错误，**When** 用户尝试添加工时，**Then** 系统提示连接失败并显示相关信息

---

### Edge Cases

- 当用户输入的任务标识在项目管理系统中不存在时，系统如何处理？（应返回清晰的错误消息：该任务不存在）
- 当用户输入负数或零作为工时数时，系统如何验证？（应拒绝并提示工时数必须为正数）
- 当用户输入的工时数超过合理范围（如单日工时超过24小时）时，系统是否需要警告？（建议提供警告但允许提交）
- 当网络连接失败或项目管理系统不可用时，系统如何处理？（应捕获异常并提示网络错误）
- 当用户输入的起止日期跨度过大（如跨年）时，系统是否需要确认？（根据业务规则，如果日期有效则接受）
- 当用户重复提交相同的工时记录时，系统是否应检测重复？（初期不检测，由后端系统处理）

## Requirements _(mandatory)_

### Functional Requirements

- **FR-001**: 系统必须能够识别目标项目（通过配置提供）
- **FR-002**: 系统必须能够安全地进行身份验证（通过配置的凭证）
- **FR-003**: 系统必须允许用户指定要记录工时的任务
- **FR-004**: 系统必须允许用户输入工作时长（以小时为单位）
- **FR-005**: 系统必须允许用户选择工时类型，从14种预设类型中选择
- **FR-006**: 系统必须允许用户输入工作的起始日期和结束日期
- **FR-007**: 系统必须验证工时数为正数
- **FR-008**: 系统必须验证日期格式符合标准日期格式（年-月-日）
- **FR-009**: 系统必须验证起始日期不晚于结束日期
- **FR-010**: 系统必须能够将工时记录提交到项目管理系统
- **FR-011**: 系统必须在提交成功后显示确认消息
- **FR-012**: 系统必须在提交失败时显示详细的错误信息
- **FR-013**: 系统必须支持以下14种工时类型：
  - 21: 研发设计
  - 22: 后端开发
  - 23: 前端开发(Web)
  - 24: 前端开发(小程序)
  - 25: 前端开发(App)
  - 26: 测试验证
  - 27: 缺陷修复
  - 28: UI设计
  - 29: 会议
  - 30: 公共事务
  - 31: 培训
  - 32: 研究
  - 33: 其它
  - 34: 调休请假

### Key Entities

- **工时记录（Work Hour Entry）**: 表示一次工作时间记录，包含任务标识、工作时长、工时类型、起止日期等属性。每条记录关联到项目管理系统中的一个特定任务。

- **工时类型（Work Hour Type）**: 表示工作内容的分类，包含类型标识和类型名称。系统预设14种类型，帮助团队统计不同类型工作的时间分布。

- **项目（Project）**: 工时记录所属的项目，通过项目标识符识别。一个项目包含多个任务和工时记录。

- **任务（Issue）**: 工时记录关联的具体工作项，通过任务标识符识别。一个任务可以有多条工时记录。

## Success Criteria _(mandatory)_

### Measurable Outcomes

- **SC-001**: 用户能够在60秒内完成一次工时记录（从启动工具到收到成功确认）
- **SC-002**: 系统能够正确处理所有14种预设工时类型，无误差
- **SC-003**: 95%的有效输入能够成功提交到项目管理系统
- **SC-004**: 所有输入验证错误都能在提交前被捕获，并提供清晰的错误消息
- **SC-005**: 用户在缺少必要配置时，能够通过错误消息在5分钟内完成配置
- **SC-006**: 100%的提交失败都能被捕获并向用户报告具体错误原因

## Dependencies and Assumptions _(mandatory)_

### Dependencies

- 系统依赖外部项目管理服务来存储和管理工时记录
- 系统需要网络连接才能提交工时记录
- 用户需要具有向目标项目和任务添加工时的权限

### Assumptions

- 用户已经在项目管理系统中有账户和相应的访问权限
- 用户知道要记录工时的任务标识符（通过项目管理系统获取）
- 项目管理系统使用预定义的14种工时类型分类
- 日期格式采用ISO 8601标准（年-月-日）
- 工时数以小时为单位，可以包含小数（如0.5小时）
- 系统配置（项目标识、认证凭证）通过配置文件或环境变量提供
- 起止日期表示工作执行的时间范围，不一定是提交工时记录的时间
